

# Running Yocto Generated Images with QEMU

This guide provides instructions on how to install QEMU and use it to run images generated by the Yocto Project from your host PC, outside of Docker.

## Installing QEMU

Before running your Yocto-generated images, ensure that QEMU is installed on your system. QEMU is a generic and open-source machine emulator and virtualizer.

### On Ubuntu/Debian-based Systems:

```bash
sudo apt-get update
sudo apt-get install qemu qemu-kvm libvirt-daemon libvirt-clients bridge-utils virt-manager
```

### On Fedora/Red Hat-based Systems:

```bash
sudo dnf install qemu-kvm qemu-img virt-manager libvirt libvirt-python libvirt-client virt-install virt-viewer bridge-utils
```

## Running the Yocto-Generated Image

To run your Yocto-generated image, use the provided launch script. Save the following script as `run_qemu.sh`, making sure to adjust the paths to the kernel and root filesystem images according to your setup.

```bash
#!/bin/bash

# QEMU VM Launch Script

# Ensure the paths below are correct for your system
# Path to the kernel image
KERNEL_IMG="path/to/your/bzImage-qemux86-64.bin"

# Path to the root filesystem image
ROOTFS_IMG="path/to/your/core-image-sato-qemux86-64-20240308193614.rootfs.ext4"

# Start QEMU with the following configurations
qemu-system-x86_64 \
    -enable-kvm \ # Enable KVM for hardware virtualization support
    -m 1024 \ # Allocate 1024 MB of memory to the VM
    -cpu host \ # Use the host CPU's configuration
    -smp cores=2 \ # Allocate 2 CPU cores to the VM
    -kernel "${KERNEL_IMG}" \ # Specify the path to the kernel image
    -drive file="${ROOTFS_IMG}",if=virtio,format=raw \ # Define the VM's drive with the root filesystem
    -net nic,model=virtio -net user,hostfwd=tcp::2222-:22 \ # Setup network and port forwarding
    -usb -device usb-tablet \ # Improve mouse integration
    -vga virtio \ # Use virtio for the VGA device
    -display sdl,gl=on \ # Use SDL for display and enable OpenGL
    -device virtio-rng-pci \ # Use a VirtIO-based RNG device to improve entropy
    -append "root=/dev/vda console=tty1 console=ttyS0" \ # Kernel boot parameters
    -serial stdio # Redirect serial I/O to the console
```

### Script Arguments Explained:

- `-enable-kvm`: Utilizes KVM for better performance by enabling hardware virtualization.
- `-m 1024`: Assigns 1GB of RAM to your virtual machine, adjustable based on your needs.
- `-cpu host`: Attempts to match the host CPU as closely as possible.
- `-smp cores=2`: Specifies the number of CPU cores for the VM. Adjust based on your system's capabilities.
- `-kernel`: Points to the kernel image to use for booting.
- `-drive`: Defines the drive using the Yocto-generated root filesystem image, using Virtio for efficiency.
- `-net`: Configures network access and forwards the host's port 2222 to the guest's port 22, useful for SSH.
- `-usb -device usb-tablet`: Enhances cursor tracking between the host and guest.
- `-vga virtio`: Uses the Virtio VGA device for the display, improving performance.
- `-display sdl,gl=on`: Uses SDL for the windowing system and tries to enable OpenGL acceleration.
- `-device virtio-rng-pci`: Adds a hardware RNG device to the VM for better entropy in cryptographic operations.
- `-append`: Passes additional kernel parameters, including device mappings and console settings.
- `-serial stdio`: Redirects serial port I/O to the host's terminal, useful for debugging and interaction.

Make the script executable with `chmod +x run_qemu.sh` and run it using `./run_qemu.sh`.

### QEMU for core-image-sato:
